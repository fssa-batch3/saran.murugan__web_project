<!DOCTYPE html>

<head lan="eng">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../Assets/css/profilesettings.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>

<body>
    <header>
        <img src="../Assets/images/logo/logo.png" alt="logo5">
    </header>
    <form>
    <div class="main1">
        
        <div class="name-user">
            <i class="user-img fa-solid fa-user"></i>
            <input type="text" required id="name" disabled>

            <div class="logout">
                <button type="button" id="logout"> log out</button>
            </div>
        </div>

        <div class="email-num">
      
                <div class="phone-num">
                    <h3>Phone:</h3>
                    <input type="text" required id="number" pattern="[0-9]{10,10}" inputmode="numeric" minlength="10"
                        maxlength="10" disabled>
                </div>

                <div class="email">
                    <h3>Email:</h3>
                    <p id="email" style="color:white;"></p>
                </div>

        </div>
        <div class="edit">
            <button type="button" id="edit">Edit</button>
            <button type="submit" id="save">Save</button>
        </div>

        </form>

        <div class="Home-a-tag">
            <a href="../index.html">
                <h4>Go to home</h4>
            </a>
        </div>

    </div>

    <div class="setting-option">
        <ul>
            <li id="booking-history-head">Booking history</li>


        </ul>
    </div>

    <div class="content-all">

        <div class="booking-history-div">

        </div>

        

    

        <div class="notification"></div>


        </div>



    <script>

        const booking_history_head = document.getElementById("booking-history-head");
        // const notification_head = document.getElementById("notification-head");
        // const help_support_head = document.getElementById("help-support-head");
        // const about_us_head = document.getElementById("about-us-head");

        const booking_history = document.querySelector(".booking-history-div");
        // const notification = document.querySelector(".notification");
        // const help_support = document.querySelector(".help-support");
        // const about_us = document.querySelector(".about-us");

        booking_history_head.addEventListener("click", () => {
            booking_history.style.display = "block";
        
            // notification.style.display = "none";
            // help_support.style.display = "none";
            // about_us.style.display = "none";
        })
        // cinemas_head.addEventListener("click", function () {
        //     booking_history.style.display = "none";
        //     //  notification.style.display="none";
        //     //  help_support.style.display="none";
        //     //  about_us.style.display="none";
        // })
        // notification_head.addEventListener("click", () => {
        //     booking_history.style.display = "none";
        //     //  cinemas.style.display="none";
        //     // notification.style.display = "block";
        //     help_support.style.display = "none";
        //     about_us.style.display = "none";
        // })
        // help_support_head.addEventListener("click", () => {
        // booking_history.style.display = "none";
        //  cinemas.style.display="none";
        // notification.style.display = "none";
        // help_support.style.display = "block";
        // about_us.style.display = "none";
        // })
        // about_us_head.addEventListener("click", () => {
        // booking_history.style.display = "none";
        //  cinemas.style.display="none";
        // notification.style.display = "none";
        // help_support.style.display = "none";
        // about_us.style.display = "block";
        // });



        const profile_details = JSON.parse(localStorage.getItem("profile_details"))
        const booking_history_div = document.querySelector(".booking-history-div");

        const booking_history_det = JSON.parse(localStorage.getItem("booking_history"));

        if (booking_history_det !== null) {

            for (let i = 0; i < booking_history_det.length; i++) {

                if (profile_details.email == booking_history_det[i].email) {

                    const booking_history_content = document.createElement("div");
                    booking_history_content.setAttribute("class", "booking-history-div-content");
                    booking_history_div.append(booking_history_content);

                    const movie_image = document.createElement("img");
                    movie_image.setAttribute("class", "movie_image")
                    movie_image.setAttribute("src", booking_history_det[i].movie_image);
                    booking_history_content.append(movie_image);

                    const ticket_detail_div = document.createElement("div");
                    ticket_detail_div.setAttribute("class", "ticket-detail-div");
                    booking_history_content.append(ticket_detail_div);

                    const movie_name = document.createElement("h1");
                    movie_name.setAttribute("class", "movie_name");
                    movie_name.innerText = booking_history_det[i].movie_name;
                    ticket_detail_div.append(movie_name)

                    // const certified = document.createElement("span");
                    // certified.innerText = "UA";
                    // movie_name.append(certified);

                    const movie_language = document.createElement("h3");
                    movie_language.innerText = booking_history_det[i].movie_language;
                    ticket_detail_div.append(movie_language);

                    const movie_frame = document.createElement("span");
                    movie_frame.innerText = booking_history_det[i].movie_frame;
                    movie_language.append(movie_frame);

                    const movie_day = document.createElement("h3");
                    movie_day.innerText = booking_history_det[i].show_day;
                    ticket_detail_div.append(movie_day);

                    const show_date = document.createElement("span");
                    show_date.innerText = booking_history_det[i].show_date;
                    movie_day.append(show_date);

                    const show_month = document.createElement("span");
                    show_month.innerText = booking_history_det[i].show_month;
                    movie_day.append(show_month);

                    const hr_line = document.createElement("span");
                    hr_line.innerText = "|";
                    movie_day.append(hr_line);

                    const show_time = document.createElement("span");
                    show_time.innerText = booking_history_det[i].show_time;
                    movie_day.append(show_time);

                    const theatre_name = document.createElement("h3");
                    theatre_name.innerText = booking_history_det[i].theatre_name;
                    ticket_detail_div.append(theatre_name);

                    const qr_ticket_div = document.createElement("div");
                    qr_ticket_div.setAttribute("class", "qr_ticket_div")
                    ticket_detail_div.append(qr_ticket_div);

                    const ticket_total_div = document.createElement("div")
                    ticket_total_div.setAttribute("class", "ticket_total_div");
                    qr_ticket_div.append(ticket_total_div);

                    const tickets = document.createElement("h3");
                    tickets.innerText = "tickets";
                    ticket_total_div.append(tickets);

                    const how_many_ticket = document.createElement("span");
                    how_many_ticket.innerText = "3";
                    tickets.prepend(how_many_ticket);


                    if (booking_history_det[i].cab_name) {

                        const cab_div = document.createElement("p");
                        cab_div.innerText = ",";
                        tickets.append(cab_div);

                        const cab = document.createElement("span")
                        cab.innerText = booking_history_det[i].cab_name;
                        cab_div.append(cab);
                    }
                    const seats = document.createElement("h2");
                    seats.innerText = "Seats";
                    ticket_total_div.append(seats);

                    const seat_names = document.createElement("span");
                    seat_names.innerText = booking_history_det[i].seat_name;
                    seats.append(seat_names);

                    const booking_id_div = document.createElement("h3");
                    booking_id_div.innerText = "BOOKING ID:"
                    ticket_total_div.append(booking_id_div);

                    const booking_id = document.createElement("span");
                    booking_id.innerText = booking_history_det[i].booking_id;
                    booking_id_div.append(booking_id)

                    const qr_code = document.createElement("img");
                    qr_code.setAttribute("src", "https://i.ibb.co/1ZpnGvG/lets-show-QR-code.png");
                    qr_code.setAttribute("class", "qrcode")
                    qr_ticket_div.append(qr_code)

                    const hr = document.createElement("hr");
                    ticket_detail_div.append(hr)
                }

            }

        }

        const users = JSON.parse(localStorage.getItem("users"));

        const name = document.getElementById("name");
        const email = document.getElementById("email");
        const number = document.getElementById("number");
        //    document.getElementById("name").value = users["name"]
        //    document.getElementById("email").innerText = users["email"]
        //    document.getElementById("number").value = users["number"];

        const profile_arr = JSON.parse(localStorage.getItem("profile_details"));

        let check;

        users.find(userobj => {
            if (userobj.email == profile_arr.email && userobj.password == profile_arr.password) {
                name.value = userobj.name
                email.innerText = userobj.email
                number.value = userobj.number

                return check = userobj;
            }
        })

        // console.log(check)
        // console.log(check["name"])
        // name.value=check["name"];
        let edit = document.getElementById("edit");


        edit.addEventListener("click", function () {
            document.getElementById("name").disabled = false;
            document.getElementById("number").disabled = false;
        });


        let form = document.querySelector("form");

        form.addEventListener("submit", (e) => {

            check.name = document.getElementById("name").value;
            check.number = document.getElementById("number").value;

            console.log(check)

            localStorage.setItem("users", JSON.stringify(users));

            console.log(users);

        })
        const userss = JSON.parse(localStorage.getItem("users"));

        let log_out = document.getElementById("logout");
        
        log_out.addEventListener("click", (e) => {

        

            let deletefalse = delete userss

            localStorage.setItem("profile_details", deletefalse)

            swal({
                title: "Are you sure?",
                text: " Your log out your account !",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
                .then((willDelete) => {
                    if (willDelete) {
                        swal("Your account as log in!", {
                            icon: "success",
                        });
                        
                         window.location.href = "../index.html"
                    } else {
                        swal("Your account is not log outed!");
                    }

                });
          
                   
        })

        // function deleteItem() {
        //     for (let i = 0; i < users.length; i++) {
        //         console.log(document.getElementById("email").innerText)
        //         if (document.getElementById("email").innerText == users[i]["email"]) {
        //             // console.log("deleted")

        //             let message = confirm("do you want to logout ?");
        //             if (message != true) {
        //                 return false;
        //             } else {

        //                 users.splice(i, 1);
        //                 console.log(users);
        //                 localStorage.setItem("users", JSON.stringify(users));
        //                 window.location.href = "signup.html";
        //             }

        //         }
        //     }
        // }
    </script>

</body>

</html>